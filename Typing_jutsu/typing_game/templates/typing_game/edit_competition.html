{% extends 'typing_game/base.html' %}

{% block title %}Edit Competition - Typing Jutsu{% endblock %}

{% block page %}
<div class="form-container" style="width: 50%;" id="edit_competition_form_container">
    <h2>Edit Competition: {{ competition.title }}</h2>
    <form method="post">
        {% csrf_token %}
        <div class="form-group">
            <label for="title">Competition Title</label>
            <input type="text" id="title" name="title" value="{{ competition.title }}" required>
        </div>
         <div class="form-group">
            <label for="type">Competition Type</label>
            <select id="type" name="type" required onchange="ask_for_ans()">
                <option value="Normal" {% if competition.type == 'Normal' %}selected{% endif %}>Normal Typing</option>
                <option value="Reverse" {% if competition.type == 'Reverse' %}selected{% endif %}>Reverse Typing</option>
                <option value="Jumble-words" {% if competition.type == 'Jumble-words' %}selected{% endif %}>Jumbled Words</option>
            </select>
        </div>
        <div class="form-group">
            <label for="description">Description</label>
            <textarea name="description" rows="4" required>{{ competition.description }}</textarea>
        </div>
        <div class="form-group-container" id="paragraphs_and_ans">
            <div class="form-group">
                <label for="paragraphs">Paragraph(s) <p style="color: rgb(103, 128, 129); font-size:x-small" id="para_info"><i class="fas fa-info-circle"></i> Press enter key 2 times, if you want to upload multiple paragraphs!</p></label>
                <textarea name="paragraphs" id="paragraphs" placeholder="Enter the paragraphs which will be typed" rows="6" required>{{ paragraphs_raw }}</textarea>
            </div>
        </div>
        <div class="form-content">
            <div class="form-group">
                <label for="start_time">Start Time</label>
                <input type="datetime-local" id="start_time" name="start_time" value="{{ competition.start_time|date:'Y-m-d\TH:i' }}" required>
            </div>
            <div class="form-group">
                <label for="duration">Duration (minutes)</label>
                <input type="number" id="duration" name="duration" min="1" value="{{ competition.duration }}" required>
            </div>
        </div>
        <div class="button-group" style="margin-top: 1.5rem;">
            <button type="submit" class="form-submit">Update Competition</button>
            <a href="{% url 'typing_game:competitions' %}" class="button button-secondary">Cancel</a>
        </div>
    </form>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        ask_for_ans(); // Call on page load to set initial state
    });

    function ask_for_ans(){
        const select = document.getElementById('type');
        const container = document.getElementById('paragraphs_and_ans');
        const paraLabel = document.querySelector('label[for="paragraphs"]');
        const paraInfo = document.getElementById('para_info');
        const existingAnswerField = document.getElementById('ans_jumble_word_group');
        const paragraphsTextarea = document.getElementById('paragraphs');

        // Reset styles and remove answer field if it exists
        container.style.display = 'block';
        container.style.gridTemplateColumns = 'none';
        if (existingAnswerField) {
            existingAnswerField.remove();
        }
        paraLabel.firstChild.textContent = 'Paragraph(s) '; // Reset label text
        paraInfo.style.display = 'inline'; // Reset info display
        paragraphsTextarea.rows = 6;

        if(select.value == 'Jumble-words'){
            // Apply grid layout for Jumble-words
            container.style.display = 'grid';
            container.style.gridTemplateColumns = 'repeat(2, 1fr)';
            container.style.gap = '1em';
            paragraphsTextarea.rows = 8;

            // Create and append the answer textarea
            const answerHtml = 
            `<div class="form-group" id="ans_jumble_word_group">
                <label for="ans_juble_word">Answer of each word </label>
                <textarea name="ans_juble_word" id="ans_juble_word" placeholder="Enter the answers which will be matched" rows="8" required>{{ answers_raw }}</textarea>
            </div>`;
            container.insertAdjacentHTML('beforeend', answerHtml);
            paraInfo.style.display = 'none';
            paraLabel.firstChild.textContent = 'Jumble Words ';
            document.getElementById('edit_competition_form_container').style.width = '70%';
        }
        else{
            document.getElementById('edit_competition_form_container').style.width = '50%';
        }
    }
</script>
{% endblock %}
